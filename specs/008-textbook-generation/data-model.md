# Data Model: 008-textbook-generation

**Branch**: `008-textbook-generation` | **Date**: 2026-02-01

## Vector Store (Qdrant)

### Collection: `textbook-passages`

| Field | Type | Description |
|-------|------|-------------|
| `id` | string | Deterministic hash of `source_path + section_heading + chunk_index` |
| `vector` | float[384] | Embedding from `all-MiniLM-L6-v2` via Hugging Face |

**Payload fields**:

| Field | Type | Description |
|-------|------|-------------|
| `text` | string | Passage content (chunk text) |
| `source` | string | Relative file path (e.g., `docs/Part-2-humanoid-robotics/01-ros2-basics.md`) |
| `part` | string | Part name (e.g., "ROS 2 Fundamentals") |
| `part_number` | integer | Part sequence (1-6) |
| `chapter` | string | Chapter title extracted from frontmatter or first H1 |
| `section` | string | Section heading (H2/H3) this chunk belongs to |
| `chunk_index` | integer | Position within the section (0-based) |

**Vector Config**: 384 dimensions, COSINE distance.

## Relational Store (Neon Postgres)

### Table: `query_logs`

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| `id` | SERIAL | PRIMARY KEY | Auto-increment ID |
| `question` | TEXT | NOT NULL | User's question text |
| `answer` | TEXT | NOT NULL | Generated answer text |
| `sources` | JSONB | | Array of cited source passages |
| `latency_ms` | REAL | | Response latency in milliseconds |
| `created_at` | TIMESTAMPTZ | DEFAULT NOW() | Query timestamp |

### Table: `ingestion_runs`

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| `id` | SERIAL | PRIMARY KEY | Auto-increment ID |
| `started_at` | TIMESTAMPTZ | DEFAULT NOW() | Run start time |
| `completed_at` | TIMESTAMPTZ | | Run end time |
| `total_chapters` | INTEGER | | Number of chapters processed |
| `total_passages` | INTEGER | | Number of passages created |
| `status` | VARCHAR(20) | NOT NULL | `running`, `completed`, `failed` |
| `error_message` | TEXT | | Error details if failed |

### Table: `ingestion_chapters`

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| `id` | SERIAL | PRIMARY KEY | Auto-increment ID |
| `run_id` | INTEGER | REFERENCES ingestion_runs(id) | Parent run |
| `source_path` | TEXT | NOT NULL | Chapter file path |
| `part_number` | INTEGER | NOT NULL | Part (1-6) |
| `chapter_title` | TEXT | | Extracted chapter title |
| `passages_created` | INTEGER | DEFAULT 0 | Chunks generated |
| `status` | VARCHAR(20) | NOT NULL | `success`, `skipped`, `failed` |
| `error_message` | TEXT | | Error details if failed |

## Entity Relationships

```
ingestion_runs 1───* ingestion_chapters
  (one run processes many chapters)

Qdrant passages ←──── ingestion pipeline ←──── docs/*.md files
  (vector store)        (batch process)          (source content)

query_logs ←──── /query endpoint ←──── ChatWidget
  (Neon)           (FastAPI)            (Docusaurus frontend)
```

## Content Hierarchy (Docusaurus)

```
docs/
├── Part-1-introduction/        # Introduction to Physical AI
│   ├── _category_.json         # { position: 1, label: "Introduction to Physical AI" }
│   └── 01-overview.md
├── Part-2-humanoid-robotics/   # Basics of Humanoid Robotics
│   ├── _category_.json         # { position: 2, label: "Basics of Humanoid Robotics" }
│   ├── 01-ros2-basics.md
│   └── 02-urdf-modeling.md
├── Part-3-ros2/                # ROS 2 Fundamentals
│   ├── _category_.json
│   ├── 01-nodes-topics.md
│   └── 02-services-actions.md
├── Part-4-digital-twin/        # Digital Twin Simulation
│   ├── _category_.json
│   ├── 01-gazebo.md
│   └── 02-isaac-sim.md
├── Part-5-vla/                 # Vision-Language-Action Systems
│   ├── _category_.json
│   ├── 01-vla-overview.md
│   └── 02-voice-to-action.md
└── Part-6-capstone/            # Capstone
    ├── _category_.json
    └── 01-capstone-project.md
```

Each `_category_.json` controls sidebar ordering and label display. Docusaurus auto-generates the sidebar from this hierarchy when `sidebarPath` is configured with `type: 'autogenerated'`.

## Locale Structure (Urdu - Optional)

```
i18n/
└── ur/
    └── docusaurus-plugin-content-docs/
        └── current/
            ├── Part-1-introduction/
            │   └── 01-overview.md      # Urdu translation
            └── ...                      # Mirror structure as needed
```

Untranslated files fall back to the English default automatically.
